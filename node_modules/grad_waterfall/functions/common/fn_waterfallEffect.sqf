#include "script_component.hpp"

if (!hasInterface) exitwith {};
[
	{
		params ["_args", "_handle"];
		_args params [""];

		if ((ace_player distance _obj) > 2000) then {
			if !(_arrayOfEffects isEqualTo []) then {
				{
					deleteVehicle _x;
				}forEach _arrayOfEffects;
				_this set [0, [_obj, _flow, _startSize, _endSize, []]];
			};
		}else{
			if (_arrayOfEffects isEqualTo []) then {
				_flow params ["_flowX", "_flowY"];

				private _objPos = getPos _obj;
				private _effect1 = "#particlesource" createVehicleLocal _objPos;
				_effect1 setParticleCircle [0,[0,0,0]];
				_effect1 setParticleRandom [0.5,[0.1,0.1,0.1],[0,0,0],5,0.1,[0,0,0,0],0.01,0,0];
				_effect1 setParticleParams [["\A3\data_f\cl_water",1,0,1],"","Billboard",1,3,[0,0,0],[_flowX,_flowY,-7],15,1050,7.9,0,[_startSize,_endSize],[[0.80,0.90,1,0.5],[0.80,0.90,1,0.5]],[1],0,0,"","",_obj];
				_effect1 setDropInterval 0.02;

				private _effect2 = "#particlesource" createVehicleLocal _objPos;
				_effect2 setParticleCircle [0,[0,0,0]];
				_effect2 setParticleRandom [0.5,[0.1,0.1,0.1],[0,0,0],5,0.1,[0,0,0,0],0.01,0,0];
				_effect2 setParticleParams [["\A3\data_f\cl_fireD",1,0,1],"","Billboard",1,3,[0,0,0],[_flowX,_flowY,-7],15,1050,7.9,0,[_startSize,_endSize],[[1,1,1,0.5],[1,1,1,0.1]],[1],0,0,"","",_obj];
				_effect2 setDropInterval 0.05;

				private _effect3 = "#particlesource" createVehicleLocal _objPos;
				_effect3 setParticleCircle [0,[0,0,0]];
				_effect3 setParticleRandom [0.5,[0.1,0.1,0.1],[0,0,0],5,0.1,[0,0,0,0],0.01,0,0];
				_effect3 setParticleParams [["\A3\data_f\ParticleEffects\Universal\smoke.p3d",1,0,1],"","Billboard",1,3,[0,0,0],[_flowX,_flowY,-7],15,1050,7.9,0,[_startSize,_endSize],[[0.85,0.95,1,0.5],[1,1,1,0.1]],[1],0,0,"","",_obj];
				_effect3 setDropInterval 0.05;

				_this set [0, [_obj, _flow, _startSize, _endSize, [_effect1, _effect2, _effect3]]];
			};
		};
	},
	10,
	_this
] call CBA_fnc_waitUntilAndExecute;
