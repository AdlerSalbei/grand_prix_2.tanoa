#include "script_component.hpp"
if (!hasInterface) exitWith {};

params ["_pos", "_type", "_smokeDiameter", "_changeInterval", ["_parameters", []]];

switch (_type) do {
	case 1 : {
		private _smoke = "#particlesource" createVehicleLocal _pos;
		_smoke setParticleCircle [round (_smokeDiameter/10), [0, 0, 0]];
		_smoke setParticleRandom [4, [0, 0, 0], [3, 3, 2], 5, 0.25, [0.9, 0.3, 0.3, 1], 0, 0];
		_smoke setParticleParams [["\A3\data_f\cl_basic", 1, 0, 1], "", "Billboard", 1, 10, [0, 0, 3], [0, 0, 10+random 30], 21, 21, 7, 0.01, [30, 5, 10], [[0.7, 0.6, 0.3, 1], [0.3, 0.1, 0.1, 1], [0.3, 0.1, 0.1, 0]], [0.08], 1, 0, "", "", GVAR(vulcanoObject)];
		_smoke setDropInterval 0.1;
		[{deleteVehicle _this;}, _smoke, _changeInterval] call CBA_fnc_waitAndExecute;
	};
	case 2 : {
		_parameters params ["_varX", "_varY", "_varZ", "_weight", "_dimOne", "_dimTwo", "_dimThree"];

		private _smoke = "#particlesource" createVehicleLocal _pos;
		_smoke setParticleCircle [_smokeDiameter/6, [_varX,_varY, _varZ]];
		_smoke setParticleRandom [0, [0, 0, 0], [0, 0, 0], 0, 0, [0, 0, 0, 0], 0, 0];
		_smoke setParticleParams [["\A3\data_f\cl_basic", 1, 0, 1], "", "Billboard", 1, 60, [0,0, 0], [_varY,_varY, _varZ], 11, _weight, 45, 0.7, [_dimOne, _dimTwo, _dimThree], [[0.4, 0.4, 0.4, 1], [0, 0, 0, 1], [0, 0, 0, 0]], [0.08], 1, 0, "", "", GVAR(vulcanoObject)];
		_smoke setDropInterval 0.2;
		[{deleteVehicle _this;}, _smoke, _changeInterval] call CBA_fnc_waitAndExecute;
	};
	case 3 : {
		private _soundObj = "Land_HelipadEmpty_F" createVehicleLocal (_pos vectorAdd [0,0,1000]);
		private _lightPoint = "#lightpoint" createVehicle getPosATL _soundObj;
		_lightPoint setLightAttenuation [0, 0, 0, 0, 40,2000];
		_lightPoint setLightIntensity 0;
		_lightPoint setLightBrightness 0;
		_lightPoint setLightDayLight true;
		_lightPoint setLightUseFlare true;
		_lightPoint setLightFlareSize 40;
		_lightPoint setLightFlareMaxDistance 1500;
		_lightPoint setLightAmbient[1,1,1];
		_lightPoint setLightColor[1,1,1];
		_lightPoint setLightIntensity 4000;
		_lightPoint setLightBrightness 10;

		[{
			params ["_pos", "_smokeDiameter", "_soundObj", "_lightPoint"];
			private _smoke = "#particlesource" createVehicleLocal _pos;
			_smoke setParticleCircle [0, [0, 0, 0]];
			_smoke setParticleRandom [0, [0.25, 0.25, 0], [0.175, 0.175, 0], 0, 0, [0, 0, 0, 0.1], 0, 0];
			_smoke setParticleParams [["\A3\data_f\blesk1", 1, 0, 1], "", "SpaceObject", 1, 20, [0, 0, 1100 + random 200], [0, 0, 0], 0, 0, 0, 0, [3, 3, 3], [[0, 0, 0, 1], [0.2, 0.2, 0.2, 1], [0, 0, 0, 1]], [0.08], 1, 0, "", "", _pos];
			_smoke setDropInterval 15;

			[{
				params ["", "", "", "_lightPoint"];
				_lightPoint setLightIntensity 5000;
				_lightPoint setLightBrightness 100;

				[{
					params ["_pos", "", "_soundObj", "_lightPoint", "_smoke"];
					deleteVehicle _smoke;
					_soundObj say3D [(selectRandom ["tunet_v_4","tunet_v_5","tunet_v_6","tunet_v_9"]), 15000];
					GVAR(intensity) = 50;
					[{
						params ["", "_handle"];
						if (GVAR(intensity) > 0) exitWith {[_handle] call CBA_fnc_removePerFrameHandler;};
						GVAR(intensity) = GVAR(intensity)-1;
						_lightPoint setLightIntensity 0;
						_lightPoint setLightBrightness GVAR(intensity);
					},0.01, []] call CBA_fnc_addPerFrameHandler;

					[{
						params ["", "", "", "_lightPoint"];
						deleteVehicle _lightPoint;
						[{
							params ["_pos", "_smokeDiameter", "_soundObj"];
							deleteVehicle _soundObj;

							private _smokeVulcano = "#particlesource" createVehicleLocal _pos;
							_smokeVulcano setParticleCircle [_smokeDiameter/6, [0, 0, 0]];
							_smokeVulcano setParticleRandom [0, [0, 0, 0], [0, 0, 0], 0, 0, [0, 0, 0, 0], 0, 0];
							_smokeVulcano setParticleParams [["\A3\data_f\cl_basic", 1, 0, 1], "", "Billboard", 1, 60, [0, 0, 3], [0, 0, 50], 21, 21, 20, 0.07, [50, 20, 100, 50, 200,300], [[0.3, 0.2, 0.1, 1], [0.1, 0.1, 0.1, 1], [0.1, 0.1, 0.1, 1], [0.1, 0.1, 0.1, 0.5], [0.1, 0.1, 0.1, 1],[0.3, 0.3, 0.3, 0]], [0.08], 1, 0, "", "", GVAR(vulcanoObject)];
							_smokeVulcano setDropInterval 0.1;
							[{deleteVehicle _this;}, _smokeVulcano, _changeInterval] call CBA_fnc_waitAndExecute;
						}, _this, 24] call CBA_fnc_waitAndExecute;
					}, _this, 0.6] call CBA_fnc_waitAndExecute;
				}, _this, 0.4] call CBA_fnc_waitAndExecute;
			}, [_pos, _smokeDiameter, _soundObj, _lightPoint, _smoke], 0.01] call CBA_fnc_waitAndExecute;
		}, [_pos, _smokeDiameter, _soundObj, _lightPoint], 0.03] call CBA_fnc_waitAndExecute;
	};
};
