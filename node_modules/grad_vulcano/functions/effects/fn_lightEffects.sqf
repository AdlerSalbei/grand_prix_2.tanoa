#include "script_component.hpp"

params ["_illuminatedArea", "_limit"];

systemChat "Starting Light Effect";

GVAR(iluminatedArea) = _illuminatedArea;

[{
    params ["_limit", "_handle"];

    if (isNull 	GVAR(light) || {GVAR(iluminatedArea) <= _limit}) exitWith {
        [_handle] call CBA_fnc_removePerFrameHandler;
        GVAR(light) setLightBrightness 30;
        if !(GVAR(lightsFinished)) then {
            GVAR(lightsFinished) = true;
            publicVariable QGVAR(lightsFinished);
        };
    };

    GVAR(light) setLightAttenuation [0, 0,  0, 0, 40, GVAR(iluminatedArea)];
    GVAR(light) setLightBrightness (selectRandom [30,35,40]);
    GVAR(iluminatedArea) = GVAR(iluminatedArea) - 50;
    [{GVAR(light) setLightBrightness 10;}, [], 0.1] call CBA_fnc_waitAndExecute;
}, 0.2, _limit] call CBA_fnc_addPerFrameHandler;
