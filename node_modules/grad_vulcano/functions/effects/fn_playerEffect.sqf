#include "script_component.hpp"
params ["_craterRadius"];

systemChat "Starting Player Effect";

enableCamShake true;
if ((player distance2D GVAR(vulcanoObject)) < 800) then {addCamShake [0.2, 15, 45];};

// boulders
private _boulders = "#particlesource" createVehicleLocal getPosATL GVAR(vulcanoObject);
_boulders setParticleCircle [_craterRadius - 15, [100, 100, 100]];
_boulders setParticleRandom [3, [0.25, 0.25, 0], [100, 100, 100], 0, 1, [0, 0, 0, 1], 0, 0];
_boulders setParticleParams [["\A3\data_f\ParticleEffects\Universal\Mud.p3d", 1, 0, 1], "", "SpaceObject", 1, 20, [0, 0, 0], [5, 5, 100], random 3, 300, 5, 3, [2, 1, 1], [[0, 0, 0, 1], [0, 0, 0, 0.5], [0.5, 0.5, 0.5, 0]], [0.125], 1, 0, "", "", GVAR(vulcanoObject), 0, true, 0.1, [[0, 0, 0, 0]]];
_boulders setDropInterval 0.01;

// secondary explosions
private _secundaryExplosions = "#particlesource" createVehicleLocal getPosATL GVAR(vulcanoObject);
_secundaryExplosions setParticleCircle [_craterRadius - 15, [9, 9, 25]];
_secundaryExplosions setParticleRandom [3, [0.25, 0.25, 0], [11, 11, 27], 0, 0.5, [0, 0, 0, 1], 0, 0];
_secundaryExplosions setParticleParams [["\A3\data_f\cl_exp", 1, 0, 1], "", "Billboard", 1, 12.5, [0, 0, 0], [5, 5, 30], 0.3, 91, 7.9, 1, [2, 1, 0.5], [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]], [0.08], 1, 0, "", "", GVAR(vulcanoObject), 0, true, 0.1, [[0, 0, 0, 0]]];
_secundaryExplosions setDropInterval 0.02;


if (selectRandom [true, false]) then {
    addCamShake [0.5, 13 + random 15, 7 + random 13];
};
GVAR(vulcanoObject) say3d [(selectRandom ["erupt_1","erupt_2","erupt_3"]), 5000];

[
    {
        (!(isNil QGVAR(lightsFinished)) && {GVAR(lightsFinished)})
    },
    {
        params ["_boulders", "_secundaryExplosions"];
        deleteVehicle _boulders;
        deleteVehicle _secundaryExplosions;
        enableCamShake false;
        GVAR(lightsFinished) = nil;
    },
    [_boulders, _secundaryExplosions]
] call CBA_fnc_waitUntilAndExecute;
